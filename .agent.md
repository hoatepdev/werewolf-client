# 5Star Werewolf (Ma Sói) - Developer Guide

## Project Overview

- **Name**: Masoi Client (5Star Werewolf Offline)
- **Type**: Progressive Web App (PWA) for the Werewolf/Mafia party game
- **Language**: TypeScript
- **Framework**: Next.js 15 with React 19
- **Styling**: Tailwind CSS with custom design system
- **State Management**: Zustand with persistence
- **Real-time Communication**: Socket.IO
- **Push Notifications**: Firebase Cloud Messaging (FCM)
- **Target Language**: Vietnamese (vi_VN)

## Key Technologies & Dependencies

### Core Framework

- Next.js 15.3.4 with App Router
- React 19 with TypeScript 5
- Tailwind CSS 4 with custom configuration

### UI & Design

- Radix UI components (alert-dialog, checkbox, dialog, slot)
- Framer Motion for animations
- Lucide React for icons
- Custom button variants (default, yellow, black)
- TikTok Sans font family
- Dark theme with zinc color palette

### State & Data Management

- Zustand for global state with persistence
- Socket.IO client for real-time communication
- Custom hooks for debouncing, click outside, FCM

### PWA & Mobile Features

- next-pwa for Progressive Web App functionality
- Service Worker with custom build script
- Firebase Cloud Messaging for push notifications
- Responsive design optimized for mobile devices

## Project Structure

### Core Directories

- `src/app/` - Next.js App Router pages and layouts
- `src/components/` - Reusable UI components
- `src/components/ui/` - Base UI components (shadcn/ui style)
- `src/components/actions/` - Game action components
- `src/components/phase/` - Game phase components
- `src/hook/` - Custom React hooks
- `src/lib/` - Utility libraries and configurations
- `src/types/` - TypeScript type definitions
- `src/constants/` - Application constants
- `src/helpers/` - Helper functions
- `public/` - Static assets (icons, images, manifest)

### Key Files

- `src/hook/useRoomStore.ts` - Main game state management
- `src/lib/socket.ts` - Socket.IO configuration
- `src/lib/firebase.ts` - Firebase/FCM setup
- `src/constants/role.ts` - Game role definitions
- `public/manifest.json` - PWA manifest
- `scripts/build-sw.js` - Service worker build script

## Game Architecture

### Game Roles

- **Villager** (Dân làng) - No special abilities
- **Werewolf** (Sói) - Kills players at night
- **Seer** (Tiên tri) - Checks if players are werewolves
- **Witch** (Phù thủy) - Has healing and poison potions
- **Hunter** (Thợ săn) - Can kill someone when eliminated
- **Bodyguard** (Bảo vệ) - Protects players at night
- **Tanner** (Chán đời) - Wins if voted out during day

### Game Phases

- **Night Phase**: Special roles perform actions
- **Day Phase**: Discussion and voting
- **Voting Phase**: Players vote to eliminate someone
- **Ended**: Game conclusion

### Player States

- Status: `pending | approved | rejected | gm`
- Alive status: `boolean`
- Role assignment after game start

## Development Guidelines

### Code Style & Conventions

- Use ES modules (import/export) syntax, not CommonJS
- Destructure imports when possible: `import { foo } from 'bar'`
- TypeScript strict mode enabled
- Prettier formatting with Tailwind plugin
- ESLint configuration for Next.js

### Component Patterns

- Use `'use client'` directive for client components
- Implement proper TypeScript interfaces for props
- Use Radix UI primitives for accessible components
- Follow shadcn/ui component structure for UI components
- Use `cn()` utility for conditional class names

### State Management

- Zustand store with persistence for game state
- Socket.IO for real-time game events
- Custom hooks for complex logic (FCM, debouncing, etc.)
- Proper state hydration handling

### Styling Guidelines

- Tailwind CSS with custom color palette (zinc-based dark theme)
- Yellow accent color (#facc15) for primary actions
- Responsive design with mobile-first approach
- Custom font: TikTok Sans with fallbacks
- Use `motion` components for animations

## Build & Development

### Scripts

- `npm run start:dev` - Development server on port 4000 (includes SW build)
- `npm run build` - Production build (includes SW build)
- `npm run start` - Start production server
- `npm run lint` - ESLint checking
- `npm run format` - Prettier formatting
- `npm run kill-port` - Kill process on port 3000

### Environment Setup

- Node.js version specified in `.nvmrc`
- Firebase configuration required for FCM (see `FCM_SETUP.md`)
- Socket.IO server URL via `NEXT_PUBLIC_SOCKET_URL`

### PWA Configuration

- Standalone display mode
- Portrait orientation
- Vietnamese language support
- Custom shortcuts for create/join room
- Service worker with FCM support

## Testing & Quality

### Current Status

- No unit tests configured yet (`npm test` returns placeholder)
- Manual testing recommended for game flows
- FCM test page available at `/fcm-test`

### Testing Recommendations

- Test game flows: create room → join room → role assignment → game phases
- Verify PWA installation and offline functionality
- Test push notifications with FCM
- Validate responsive design on mobile devices
- Test Socket.IO connection and real-time updates

## Best Practices

### Performance

- Use Next.js Image component for optimized images
- Implement proper loading states for async operations
- Minimize bundle size with tree shaking
- Use Zustand persistence selectively

### Accessibility

- Use Radix UI for accessible components
- Proper ARIA labels and semantic HTML
- Focus management for modals and dialogs
- High contrast colors for readability

### Mobile Optimization

- Touch-friendly button sizes (minimum 44px)
- Proper viewport configuration
- Prevent zoom on form inputs
- Optimize for portrait orientation

### Security

- Validate all user inputs
- Sanitize data before Socket.IO transmission
- Use environment variables for sensitive configuration
- Implement proper error boundaries

## Deployment Considerations

- Build includes service worker generation
- Firebase configuration required for production
- Socket.IO server must be accessible
- PWA manifest and icons properly configured
- HTTPS required for service worker and FCM

## Migrated Content from CLAUDE.md

### Bash Commands

- `npm run build` - Build the project
- `npm run typecheck` - Run the typechecker (Note: not currently configured)

### Workflow

- Be sure to typecheck when making code changes
- Prefer running single tests for performance (when tests are implemented)
- Use ES modules syntax consistently
- Destructure imports when possible
